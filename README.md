# PDF è®ºæ–‡ç¿»è¯‘åŠ©æ‰‹

![translate.jpg](static/translate.jpg)

ä¸€ä¸ªåŸºäº FastAPI + Poe AI çš„ PDF è®ºæ–‡ç¿»è¯‘æœåŠ¡ï¼Œæ”¯æŒé€ç« ç¿»è¯‘ã€ä¼šè¯ç®¡ç†å’Œæ–­ç‚¹ç»­ç¿»ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“„ **PDF ä¸Šä¼ ä¸ç¿»è¯‘**ï¼šä¸Šä¼  PDF æ–‡ä»¶ï¼Œè‡ªåŠ¨è°ƒç”¨ GPT-5.2-Instant è¿›è¡Œç¿»è¯‘
- ğŸ”„ **æ–­ç‚¹ç»­ç¿»**ï¼šæ”¯æŒåˆ†ç« èŠ‚ç¿»è¯‘ï¼Œå¯éšæ—¶ç»§ç»­ç¿»è¯‘ä¸‹ä¸€ç« èŠ‚
- ğŸ’¾ **ä¼šè¯ç®¡ç†**ï¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰ç¿»è¯‘å†å²ï¼Œæ”¯æŒæŸ¥çœ‹å®Œæ•´ä¼šè¯è®°å½•
- ğŸ·ï¸ **æ ‡é¢˜è‡ªåŠ¨æå–**ï¼šä» PDF é¦–é¡µè‡ªåŠ¨æå–è®ºæ–‡æ ‡é¢˜
- ğŸ“‹ **ç»“æ„åŒ–è¾“å‡º**ï¼šæŒ‰æ‘˜è¦å’Œç« èŠ‚ç»„ç»‡ç¿»è¯‘å†…å®¹ï¼Œä½¿ç”¨ Markdown æ ¼å¼
- ğŸ—„ï¸ **æ•°æ®æŒä¹…åŒ–**ï¼šä½¿ç”¨ SQLite æ•°æ®åº“å­˜å‚¨ä¼šè¯ã€æ¶ˆæ¯å’Œæ–‡ä»¶è®°å½•

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**ï¼šFastAPI
- **æ•°æ®åº“**ï¼šSQLite + SQLModel
- **AI æœåŠ¡**ï¼šPoe API (GPT-5.2-Instant)
- **PDF å¤„ç†**ï¼šPyMuPDF (fitz)
- **å‰ç«¯**ï¼šé™æ€HTMLé¡µé¢

## éƒ¨ç½²æŒ‡å—

### å‰ç½®è¦æ±‚

- Python 3.9+
- pip æˆ– conda

### å®‰è£…ä¾èµ–

```bash
pip install fastapi uvicorn sqlmodel pymupdf fastapi-poe python-multipart gunicorn
```

### ç¯å¢ƒé…ç½®

1. è·å– Poe API Keyï¼š
   - è®¿é—® [Poeå®˜ç½‘](https://poe.com/)
   - åˆ›å»ºè´¦æˆ·å¹¶è·å– API Key

2. æœ¬åœ°ç›®å½•ç»“æ„ç¡®è®¤ï¼š
   ```
   translate/
   â”œâ”€â”€ app.py
   â”œâ”€â”€ static/
   â”‚   â””â”€â”€ index.html
   â”œâ”€â”€ uploads/           # è‡ªåŠ¨åˆ›å»º
   â””â”€â”€ translations.db    # è‡ªåŠ¨åˆ›å»º
   ```

### å¯åŠ¨æœåŠ¡

```bash
uvicorn app:app --reload
```

æœåŠ¡å°†åœ¨ `http://127.0.0.1:8000` å¯åŠ¨

å¦‚æœéœ€è¦éƒ¨ç½²ï¼Œå»ºè®®ä½¿ç”¨ `gunicorn`ï¼Œå¹¶é…ç½®åå‘ä»£ç†ã€‚

```bash
gunicorn -k uvicorn.workers.UvicornWorker app:app -w 4 -b 127.0.0.1:8000
```

## ä½¿ç”¨æ–¹æ³•

### é€šè¿‡ Web ç•Œé¢

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://127.0.0.1:8000`
2. ä¸Šä¼  PDF æ–‡ä»¶å¹¶è¾“å…¥ Poe API Key
3. ç­‰å¾… AI ç¿»è¯‘æ‘˜è¦
4. ç‚¹å‡»"ç»§ç»­"æŒ‰é’®ç¿»è¯‘ä¸‹ä¸€ç« èŠ‚
5. æŸ¥çœ‹ç¿»è¯‘å†å²è®°å½•

### é€šè¿‡ API è°ƒç”¨

#### 1. ä¸Šä¼  PDF å¹¶å¼€å§‹ç¿»è¯‘

```bash
curl -X POST "http://127.0.0.1:8000/upload" \
  -F "file=@paper.pdf" \
  -F "api_key=your_poe_api_key"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "conversation_id": "abc123def456",
  "reply": "# æ‘˜è¦\n\nè®ºæ–‡ä¸»è¦ä»‹ç»..."
}
```

#### 2. ç»§ç»­ç¿»è¯‘ä¸‹ä¸€ç« èŠ‚

```bash
curl -X POST "http://127.0.0.1:8000/continue/abc123def456" \
  -F "api_key=your_poe_api_key"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "reply": "# ç¬¬ä¸€ç« \n\nç ”ç©¶èƒŒæ™¯..."
}
```

#### 3. è·å–å®Œæ•´ä¼šè¯

```bash
curl "http://127.0.0.1:8000/conversation/abc123def456"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "id": "abc123def456",
  "title": "Deep Learning Fundamentals",
  "created_at": "2026-02-24T10:30:00",
  "messages": [
    {
      "role": "user",
      "content": "ç¿»è¯‘è¿™ç¯‡è®ºæ–‡..."
    },
    {
      "role": "bot",
      "content": "# æ‘˜è¦\n\n..."
    }
  ]
}
```

#### 4. è·å–æ‰€æœ‰ä¼šè¯åˆ—è¡¨

```bash
curl "http://127.0.0.1:8000/conversations"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
[
  {
    "id": "abc123def456",
    "title": "Deep Learning Fundamentals",
    "created_at": "2026-02-24T10:30:00"
  },
  {
    "id": "xyz789uvw012",
    "title": "Machine Learning Basics",
    "created_at": "2026-02-23T15:45:00"
  }
]
```

## API ç«¯ç‚¹è¯´æ˜

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|
| POST | `/upload` | ä¸Šä¼  PDF æ–‡ä»¶å¹¶å¼€å§‹ç¿»è¯‘ |
| POST | `/continue/{conversation_id}` | ç»§ç»­ç¿»è¯‘ä¸‹ä¸€ç« èŠ‚ |
| GET | `/conversation/{conversation_id}` | è·å–å®Œæ•´ä¼šè¯å†…å®¹ |
| GET | `/conversations` | è·å–æ‰€æœ‰ä¼šè¯åˆ—è¡¨ |
| GET | `/` | ä¸»é¡µé¢ (Web ç•Œé¢) |
| GET | `/chat/{conversation_id}` | æŸ¥çœ‹æŒ‡å®šä¼šè¯ (Web ç•Œé¢) |

## æ•°æ®å­˜å‚¨

### æ•°æ®åº“è¡¨ç»“æ„

- **Conversation**ï¼šä¼šè¯è®°å½•ï¼ˆIDã€æ ‡é¢˜ã€æ–‡ä»¶åã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ï¼‰
- **Message**ï¼šæ¶ˆæ¯è®°å½•ï¼ˆIDã€ä¼šè¯IDã€è§’è‰²ã€å†…å®¹ã€åˆ›å»ºæ—¶é—´ï¼‰
- **FileRecord**ï¼šæ–‡ä»¶è®°å½•ï¼ˆIDã€ä¼šè¯IDã€æ–‡ä»¶è·¯å¾„ã€Poe CDN ä¿¡æ¯ï¼‰

### æ–‡ä»¶ä½ç½®

- **PDF æ–‡ä»¶**ï¼š`uploads/{file_id}.pdf`
- **æ•°æ®åº“**ï¼š`translations.db`

## å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·ä¸Šä¼  PDF
   â†“
2. ç³»ç»Ÿä¿å­˜æœ¬åœ°å‰¯æœ¬
   â†“
3. ä¸Šä¼ åˆ° Poe CDNï¼ˆè·å¾—å¯å¤ç”¨ URLï¼‰
   â†“
4. å‘é€åˆå§‹ç¿»è¯‘è¯·æ±‚ï¼ˆåŒ…å« PDF attachmentï¼‰
   â†“
5. ä¿å­˜ä¼šè¯å’Œç¬¬ä¸€æ®µå›å¤
   â†“
6. ç”¨æˆ·ç‚¹å‡»"ç»§ç»­"
   â†“
7. é‡ç”¨ Poe CDN URLï¼Œæ— éœ€é‡æ–°ä¸Šä¼ æ–‡ä»¶
   â†“
8. ç»§ç»­ç¿»è¯‘ï¼Œä¿å­˜æ–°æ¶ˆæ¯
   â†“
9. é‡å¤ 6-8 ç›´åˆ°å®Œæˆ
```

## å¸¸è§é—®é¢˜

**Q: API Key åœ¨å“ªé‡Œè·å–ï¼Ÿ**
A: è®¿é—® [Poeå®˜ç½‘](https://poe.com/) æ³¨å†Œè´¦æˆ·ï¼Œåœ¨è®¾ç½®ä¸­è·å– API Keyã€‚

**Q: å¦‚ä½•ä¿®æ”¹ç¿»è¯‘æç¤ºè¯ï¼Ÿ**
A: ç¼–è¾‘ `app.py` ä¸­ `/upload` ç«¯ç‚¹çš„ `initial_prompt` å˜é‡å³å¯ã€‚

**Q: å¯ä»¥ä½¿ç”¨å…¶ä»– Poe æ¨¡å‹å—ï¼Ÿ**
A: å¯ä»¥ã€‚ä¿®æ”¹ `fp.get_bot_response()` ä¸­çš„ `bot_name` å‚æ•°ï¼Œæ”¹ä¸ºå…¶ä»–å¯ç”¨çš„æ¨¡å‹åç§°ã€‚

